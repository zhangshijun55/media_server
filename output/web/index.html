<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Server</title>
    <script src="https://cdn.jsdelivr.net/npm/mpegts.js@1.7.3/dist/mpegts.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!-- Left Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2 data-i18n="mediaServer">Media Server</h2>
            <div class="lang-switcher">
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="zh">中文</button>
            </div>
        </div>
        <div class="nav-item active" data-target="device">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
            </svg>
            <span data-i18n="navDevice">Device</span>
        </div>
        <div class="nav-item" data-target="file">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
            </svg>
            <span data-i18n="navFile">File</span>
        </div>
        <div class="nav-item" data-target="gbdomain">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
            </svg>
            <span data-i18n="navGbDomain">GB Domain</span>
        </div>
        <div class="nav-item" data-target="webrtc">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0" />
            </svg>
            <span data-i18n="navWebrtc">WebRTC</span>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Device Section -->
        <div id="device-section" class="content-section active">
            <div class="content-header">
                <h1 data-i18n="deviceList">Device List</h1>
            </div>

            <!-- Device Tabs -->
            <div class="device-tabs">
                <button class="device-tab active" data-device-target="device-list-tab" data-i18n="deviceList">Device
                    List</button>
                <button class="device-tab" data-device-target="ptz-control-tab" data-i18n="ptzControl">PTZ
                    Control</button>
            </div>

            <!-- Device List Tab -->
            <div id="device-list-tab" class="device-tab-content active">
                <div class="header-buttons" style="margin-bottom: 15px;">
                    <button class="add-btn" onclick="showAddDeviceModal()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                        </svg>
                        <span data-i18n="addDevice">Add Device</span>
                    </button>
                    <button class="refresh-btn" onclick="loadDevices()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                        <span data-i18n="refresh">Refresh</span>
                    </button>
                </div>
                <div id="device-content" class="data-table">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>

            <!-- PTZ Control Tab -->
            <div id="ptz-control-tab" class="device-tab-content">
                <div class="header-buttons" style="margin-bottom: 15px;">
                    <button class="refresh-btn" onclick="loadPTZDevices()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                        <span data-i18n="refresh">Refresh</span>
                    </button>
                </div>
                <div id="ptz-device-content" class="data-table">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- File Section -->
        <div id="file-section" class="content-section">
            <div class="content-header">
                <h1 data-i18n="fileList">File List</h1>
                <div class="header-buttons">
                    <input type="file" id="file-upload-input"
                        accept="video/*,audio/*,.mkv,.avi,.wmv,.flv,.webm,.mov,.mp4,.m4v,.ts,.m2ts,.mts"
                        onchange="uploadFile(this)">
                    <button class="upload-btn" onclick="document.getElementById('file-upload-input').click()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                        </svg>
                        <span data-i18n="upload">Upload</span>
                    </button>
                    <button class="refresh-btn" onclick="loadFiles()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                        <span data-i18n="refresh">Refresh</span>
                    </button>
                </div>
            </div>
            <div id="file-content" class="data-table">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>

        <!-- GB Domain Section -->
        <div id="gbdomain-section" class="content-section">
            <div class="content-header">
                <h1>GB28181</h1>
            </div>

            <!-- GB Tabs -->
            <div class="gb-tabs">
                <button class="gb-tab active" data-gb-target="gb-domain-tab" data-i18n="domainList">Domain List</button>
                <button class="gb-tab" data-gb-target="gb-record-tab" data-i18n="gbRecord">GB Record</button>
            </div>

            <!-- Domain List Tab -->
            <div id="gb-domain-tab" class="gb-tab-content active">
                <div style="display: flex; justify-content: flex-end; margin-bottom: 15px;">
                    <button class="catalog-btn" onclick="syncGbCatalog()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                        <span data-i18n="catalog">Catalog</span>
                    </button>
                    <button class="info-btn" onclick="showGbServerInfo()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <span data-i18n="serverInfo">Server Info</span>
                    </button>
                    <button class="refresh-btn" onclick="loadGbDomains()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                        <span data-i18n="refresh">Refresh</span>
                    </button>
                </div>
                <div id="gbdomain-content" class="data-table">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>

            <!-- GB Record Tab -->
            <div id="gb-record-tab" class="gb-tab-content">
                <div class="search-form">
                    <div class="search-form-row">
                        <div class="search-form-group" style="flex: 2;">
                            <label data-i18n="gbDevice">GB Device</label>
                            <select id="gb-record-device">
                                <option value="" data-i18n="selectDevice">-- Select Device --</option>
                            </select>
                        </div>
                        <div class="search-form-group">
                            <label data-i18n="startTime">Start Time</label>
                            <input type="datetime-local" id="gb-record-start">
                        </div>
                        <div class="search-form-group">
                            <label data-i18n="endTime">End Time</label>
                            <input type="datetime-local" id="gb-record-end">
                        </div>
                        <div class="search-form-group" style="flex: 0.5; min-width: 100px;">
                            <label data-i18n="type">Type</label>
                            <select id="gb-record-type">
                                <option value="all" data-i18n="typeAll">All</option>
                                <option value="time" data-i18n="typeTime">Time</option>
                                <option value="alarm" data-i18n="typeAlarm">Alarm</option>
                                <option value="manual" data-i18n="typeManual">Manual</option>
                            </select>
                        </div>
                        <button class="search-btn" onclick="searchGbRecords()" data-i18n="search">Search</button>
                    </div>
                </div>
                <div id="gb-record-content" class="data-table">
                    <div class="empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                        <p data-i18n="searchRecordsHint">Select a device and time range to search records</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- WebRTC Section -->
        <div id="webrtc-section" class="content-section">
            <div class="content-header">
                <h1 data-i18n="webrtcSessionList">WebRTC Session List</h1>
                <button class="refresh-btn" onclick="loadWebRTCSessions()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    <span data-i18n="refresh">Refresh</span>
                </button>
            </div>
            <div id="webrtc-content" class="data-table">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Video Modal -->
    <div id="video-modal" class="video-modal">
        <div class="video-container">
            <div class="video-header">
                <h3 id="video-title">Device Preview</h3>
                <button class="close-btn" onclick="closeVideoModal()">&times;</button>
            </div>
            <div class="video-content-wrapper">
                <div style="position: relative;">
                    <video id="video-player" controls autoplay></video>
                    <div id="video-loading" class="video-loading" style="display: none;">
                        <div class="spinner"></div>
                    </div>
                </div>
                <!-- PTZ Control Panel -->
                <div id="ptz-panel" class="ptz-control-panel">
                    <div class="ptz-panel-title" data-i18n="ptzControl">PTZ Control</div>
                    <div class="ptz-grid">
                        <button class="ptz-btn" onclick="sendPTZCommand(11)" title="Left Up">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M7 11l5-5m0 0l5 5m-5-5v12" transform="rotate(-45 12 12)" />
                            </svg>
                        </button>
                        <button class="ptz-btn" onclick="sendPTZCommand(3)" title="Up">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 10l7-7m0 0l7 7m-7-7v18" />
                            </svg>
                        </button>
                        <button class="ptz-btn" onclick="sendPTZCommand(12)" title="Right Up">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M7 11l5-5m0 0l5 5m-5-5v12" transform="rotate(45 12 12)" />
                            </svg>
                        </button>
                        <button class="ptz-btn" onclick="sendPTZCommand(1)" title="Left">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 19l-7-7 7-7" />
                            </svg>
                        </button>
                        <button class="ptz-btn" style="background-color: #2c3e50; cursor: default;" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <circle cx="12" cy="12" r="3" stroke-width="2" />
                            </svg>
                        </button>
                        <button class="ptz-btn" onclick="sendPTZCommand(2)" title="Right">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 5l7 7-7 7" />
                            </svg>
                        </button>
                        <button class="ptz-btn" onclick="sendPTZCommand(13)" title="Left Down">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M7 13l5 5m0 0l5-5m-5 5V6" transform="rotate(-45 12 12)" />
                            </svg>
                        </button>
                        <button class="ptz-btn" onclick="sendPTZCommand(4)" title="Down">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 14l-7 7m0 0l-7-7m7 7V3" />
                            </svg>
                        </button>
                        <button class="ptz-btn" onclick="sendPTZCommand(14)" title="Right Down">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M7 13l5 5m0 0l5-5m-5 5V6" transform="rotate(45 12 12)" />
                            </svg>
                        </button>
                    </div>
                    <div class="ptz-zoom">
                        <button class="ptz-zoom-btn" onclick="sendPTZCommand(5)" title="Zoom In">
                            <span data-i18n="zoomIn">Zoom +</span>
                        </button>
                        <button class="ptz-zoom-btn" onclick="sendPTZCommand(6)" title="Zoom Out">
                            <span data-i18n="zoomOut">Zoom -</span>
                        </button>
                    </div>
                    <div class="ptz-timeout">
                        <label for="ptz-timeout-input">Timeout (ms):</label>
                        <input type="number" id="ptz-timeout-input" value="500" min="100" max="5000" step="100">
                    </div>
                    <div class="ptz-preset">
                        <div class="ptz-preset-buttons">
                            <button class="ptz-preset-btn" onclick="refreshPresets()"
                                title="Refresh Preset List">Refresh</button>
                            <button class="ptz-preset-btn" onclick="gotoPreset()"
                                title="Go to Selected Preset">Goto</button>
                            <button class="ptz-preset-btn" onclick="addPreset()" title="Add New Preset">Add</button>
                            <button class="ptz-preset-btn" onclick="deletePreset()"
                                title="Delete Selected Preset">Delete</button>
                        </div>
                        <div class="ptz-preset-list" id="ptz-preset-list">
                            <div class="ptz-preset-empty">No presets available</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Device Modal -->
    <div id="add-device-modal" class="form-modal">
        <div class="form-container">
            <div class="form-header">
                <h3 data-i18n="addDevice">Add Device</h3>
                <button class="close-btn" onclick="closeAddDeviceModal()">&times;</button>
            </div>
            <div class="form-body">
                <div class="form-group">
                    <label><span data-i18n="protocol">Protocol</span> <span class="required">*</span></label>
                    <select id="device-protocol" onchange="onProtocolChange()">
                        <option value="2">RTSP</option>
                        <option value="4">ONVIF</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><span data-i18n="name">Name</span> <span class="required">*</span></label>
                    <input type="text" id="device-name" data-i18n-placeholder="enterDeviceName"
                        placeholder="Enter device name">
                </div>
                <div class="form-group" id="url-group">
                    <label>URL <span class="required">*</span></label>
                    <input type="text" id="device-url" placeholder="rtsp://user:pass@ip:port/path">
                </div>
                <div class="form-group" id="ipaddr-group" style="display: none;">
                    <label><span data-i18n="ipAddress">IP Address</span> <span class="required">*</span></label>
                    <input type="text" id="device-ipaddr" placeholder="192.168.1.100">
                </div>
                <div class="form-group" id="user-group" style="display: none;">
                    <label><span data-i18n="username">Username</span> <span class="required">*</span></label>
                    <input type="text" id="device-user" placeholder="admin">
                </div>
                <div class="form-group" id="pass-group" style="display: none;">
                    <label><span data-i18n="password">Password</span> <span class="required">*</span></label>
                    <input type="password" id="device-pass" data-i18n-placeholder="enterPassword"
                        placeholder="Enter password">
                </div>
            </div>
            <div class="form-footer">
                <button class="btn-cancel" onclick="closeAddDeviceModal()" data-i18n="cancel">Cancel</button>
                <button class="btn-submit" onclick="submitAddDevice()" data-i18n="add">Add</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>

</html>